model User {
    id          String @id @default(cuid())
    piId        String @unique // Pi Network User ID
    username    String @unique // Pi Network Username
    accessToken String @unique // Pi access token

    sharePoints Float @default(0.0) // Used for Token conversion
    totalEarned Float @default(0.0)
    level       Int   @default(1)
    xp          Int   @default(0)

    /// username of user's referrer
    referrer             String?
    /// no of users referred
    noOfReferrals        Int       @default(0) // Used for Discounts
    /// Number of times the user has used the resonance discount
    /// Tracks how many discounts have been consumed (geometric cost progression)
    resonanceFidelity    Int       @default(0)
    // Retention
    dailyStreak          Int       @default(0)
    lastTunedAt          DateTime?
    // Tutorial completion flag for Ephemeral Spark (client-side virtual node)
    hasCompletedTutorial Boolean   @default(false)

    createdAt  DateTime  @default(now())
    updatedAt  DateTime  @updatedAt
    archivedAt DateTime?

    lastDriftAt DateTime? // Cooldown tracking
    driftCount  Int       @default(0) // Tracks number of drifts performed (0 = new player eligibility)

    // Relations
    echoTransmission       EchoTransmission? // One-to-one relationship
    sessions               MiningSession[]
    mastery                UserNodeMastery[]
    firmwareBoosts         FirmwareBoost[]
    redemptions            ShareRedemption[]
    achievements           UserAchievement[]
    loreContributions      LocationLoreStake[] // Pi staking for lore
    awakeningContributions AwakeningContribution[] // Pi contribution for lattice calibration
    resonantAnchors        ResonantAnchor[] // Pi contribution for resonant anchors
    tuningSessions         TuningSession[]
    drifts                 NodeDrift[] // Relation to user's drifts
    echoResonanceChambers  EchoResonanceChamber[] // Personal boost chambers
    // Guild membership
    guildMembership        GuildMember?
    guildLed               Guild?                  @relation("GuildLeader")

    @@map("users")
}
